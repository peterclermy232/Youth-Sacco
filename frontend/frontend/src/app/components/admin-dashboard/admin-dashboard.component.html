<div class="admin-container">
  <div class="admin-header">
    <h1>Admin Dashboard</h1>
    <button mat-raised-button color="warn" (click)="logout()">
      <mat-icon>logout</mat-icon> Logout
    </button>
  </div>

  @if (stats) {
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>group</mat-icon>
          </div>
          <div class="stat-value">{{ stats.total_members }}</div>
          <div class="stat-label">Total Members</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card pending">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon [matBadge]="stats.pending_contributions" matBadgeColor="warn">pending</mat-icon>
          </div>
          <div class="stat-value">{{ stats.pending_contributions }}</div>
          <div class="stat-label">Pending Verifications</div>
        </mat-card-content>
      </mat-card>

      @for (summary of stats.contribution_summaries; track summary.id) {
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>account_balance</mat-icon>
            </div>
            <div class="stat-value">KES {{ summary.total_amount }}</div>
            <div class="stat-label">{{ summary.contribution_type_name }} Total</div>
            <div class="stat-detail">{{ summary.total_contributions }} contributions</div>
          </mat-card-content>
        </mat-card>
      }
    </div>
  }

  <div class="pending-section">
    <h2>Pending Contributions</h2>
    @if (pendingContributions.length > 0) {
      <table mat-table [dataSource]="pendingContributions" class="pending-table">
        <ng-container matColumnDef="member">
          <th mat-header-cell *matHeaderCellDef>Member</th>
          <td mat-cell *matCellDef="let contribution">
            {{ contribution.member_details?.first_name }} {{ contribution.member_details?.last_name }}
          </td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let contribution">
            {{ contribution.contribution_type_name }}
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Amount</th>
          <td mat-cell *matCellDef="let contribution">
            KES {{ contribution.amount }}
          </td>
        </ng-container>

        <ng-container matColumnDef="transaction">
          <th mat-header-cell *matHeaderCellDef>M-Pesa Code</th>
          <td mat-cell *matCellDef="let contribution">
            {{ contribution.mpesa_transaction_code }}
          </td>
        </ng-container>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Submitted</th>
          <td mat-cell *matCellDef="let contribution">
            {{ contribution.submitted_at | date:'short' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let contribution">
            <button mat-raised-button color="primary" (click)="verifyContribution(contribution.id)">
              Verify
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    } @else {
      <mat-card>
        <mat-card-content>
          <p>No pending contributions</p>
        </mat-card-content>
      </mat-card>
    }
  </div>

  <div class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="action-buttons">
      <button mat-raised-button color="primary" routerLink="/admin/members">
        <mat-icon>group</mat-icon> View All Members
      </button>
      <button mat-raised-button color="accent" routerLink="/admin/contributions">
        <mat-icon>list</mat-icon> All Contributions
      </button>
      <button mat-raised-button routerLink="/admin/balances">
        <mat-icon>account_balance_wallet</mat-icon> Member Balances
      </button>
    </div>
  </div>
</div>


